image: maven:3.8.5-openjdk-17

stages:
  - lint
  - build
  - test
  - coverage
  - package

before_script:
  # Certifica-se de que o diretório libs e os JARs fictícios estão disponíveis
  - echo "Iniciando o pipeline com JARs fictícios no diretório libs..."

lint-job:
  stage: lint
  script:
    - echo "Executando linter para análise estática do código..."
    - mvn checkstyle:check
    - echo "Análise estática de código concluída."
  allow_failure: true  # Permite que o pipeline continue mesmo que o lint falhe

build-job:
  stage: build
  script:
    - echo "Compilando o código-fonte com dependências fictícias..."
    - mvn clean compile -DskipTests -Dmaven.test.skip=true
    - echo "Compilação concluída."
  artifacts:
    paths:
      - target/classes

unit-test-job:
  stage: test
  needs: [build-job]
  script:
    - echo "Executando testes unitários..."
    - mvn test -Dtest='!*FormControllerTest' -DfailIfNoTests=false
    - echo "Testes unitários concluídos."
  artifacts:
    paths:
      - target/surefire-reports/

coverage-job:
  stage: coverage
  needs: [unit-test-job]
  script:
    - echo "Gerando relatório de cobertura de código com Jacoco..."
    - mvn verify jacoco:report
    - echo "Relatório de cobertura gerado."
  artifacts:
    paths:
      - target/site/jacoco/

package-job:
  stage: package
  needs: [coverage-job]
  script:
    - echo "Empacotando a aplicação com dependências fictícias..."
    - mvn clean package -DskipTests -Dmaven.test.skip=true
    - echo "Aplicação empacotada."
  artifacts:
    paths:
      - target/*.jar
